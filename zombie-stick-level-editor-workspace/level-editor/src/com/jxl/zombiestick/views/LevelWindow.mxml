<?xml version="1.0" encoding="utf-8"?>
<s:Window xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx" 
		  width="1024" height="800"
		  xmlns:zombiestick="com.jxl.zombiestick.*" xmlns:levelviews="com.jxl.zombiestick.views.levelviews.*">
	
	<fx:Script>
		<![CDATA[
		import com.jxl.zombiestick.events.SaveLevelServiceEvent;
		import com.jxl.zombiestick.services.SaveLevelService;
		import com.jxl.zombiestick.vo.LevelVO;

		[Bindable]
		public var level:LevelVO;

		private var file:File;
		private var saveService:SaveLevelService;

		private function onBrowseForBackgroundImage():void
		{
			if (file == null)
			{
				file = new File();
				file.addEventListener(Event.SELECT, onBackgroundImageSelected);
			}
			file.browseForOpen("Background Image", [new FileFilter("JPG", "*.jpg;*.jpeg"), new FileFilter("PNG", "*.png;")]);
		}

		private function onBackgroundImageSelected(event:Event):void
		{
			level.backgroundImage = file.url;
		}

		private function onNew():void
		{
			levelCanvas.newGameObject(levelCanvasScroller.viewport.horizontalScrollPosition, levelCanvasScroller.viewport.verticalScrollPosition);
		}

		private function onSave():void
		{
			if (saveService == null)
			{
				saveService = new SaveLevelService();
				saveService.addEventListener(SaveLevelServiceEvent.SUCCESS, onSaved);
			}
			saveService.saveLevel(level);
		}

		private function onSaved(event:SaveLevelServiceEvent):void
		{
		}
		]]>
	</fx:Script>
	
	<s:VGroup>
		<s:HGroup>
			<s:Label text="Background:" />
			<s:TextInput id="backgroundImagePath" editable="false" text="{level.backgroundImage}" toolTip="{level.backgroundImage}" />
			<s:Button label="Browse" click="onBrowseForBackgroundImage()" />
			<s:Button label="New" click="onNew()" />
			<s:Button label="Save" click="onSave()" />
		</s:HGroup>
		
		<s:HGroup>
			<s:Group>
				<s:Image source="@Embed(source='/assets/images/iphone.png')"
						 top="30" left="10"/>
				
				<s:Scroller top="162" left="43"
							width="320" height="320"
							id="levelCanvasScroller">
					<s:Group>
						<s:Rect width="{levelCanvas.width}" height="{levelCanvas.height}">
							<s:fill>
								<s:SolidColor color="#FF0000" alpha="0" />
							</s:fill>
						</s:Rect>
						
						<zombiestick:LevelCanvas id="levelCanvas" level="{level}" />
						
					</s:Group>
				</s:Scroller>
			</s:Group>
			
			<levelviews:PropertiesPanel />
			
			<!--
			<levelviews:MoviePanel movies="{level.movies}" />
			-->
			
			<!--
			<s:VGroup width="200" height="100%">
				<s:Label text="Selections:" />
				<s:List dataProvider="{levelCanvas.selections}" labelField="type" width="100%" height="100%" />
			</s:VGroup>
			-->
			
			<levelviews:LayersPanel />
			
		</s:HGroup>
	</s:VGroup>
	
	
	
</s:Window>
